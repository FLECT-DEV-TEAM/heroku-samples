<div>
	<p>メールを送信するサンプルです。</p>
</div>
<div class="sample">
	<p>{{from}}から入力された内容でメールを送信します。</p>
	<form action="/mail" method="POST">
		<table>
			<tr>
				<td>宛先</td><td><input name="to" value="{{to}}"></td>
			</tr>
			<tr>
				<td>タイトル</td><td><input name="subject" value="{{subject}}"></td>
			</tr>
			<tr>
				<td>本文</td><td><textarea cols="40" rows="5" name="body">{{body}}</textarea></td>
			</tr>
		</table>
		<div>
			<input type="submit" value="Send" class="btn"/>
		</div>
	</form>
	<div>
		<p>{{to}}</p>
		{{message}}
	</div>
</div>
<div id="markdown_content">
## サンプルについて

Addonの[SendGrid](http://sendgrid.com/)を使用してメールを送信するサンプルです。  
メール送信はSendGridのWebAPIを[ラッパーライブラリ](https://github.com/shunjikonishi/sendgrid4j)を使用して叩いています。
データベース(PostgreSQL)への接続情報は環境変数のDATABASE_URLから取得します。

Addonの追加コマンドは以下です。(Starterは無料)

```
heroku addons:add sendgrid
```

Addonを追加すると環境変数にSENDGRID_USERNAME, SENDGRID_PASSWORDという二つの変数が設定されるのでそれらの認証情報を用いてSendGridに接続してAPIを実行します。

## SPFとDKIMの設定
メールではFromにどんなメールアドレスでも設定できることから簡単になりすましができます。  
近年では[SPF](http://ja.wikipedia.org/wiki/Sender_Policy_Framework)や[DKIM](http://ja.wikipedia.org/wiki/%E3%83%89%E3%83%A1%E3%82%A4%E3%83%B3%E3%82%AD%E3%83%BC%E3%83%BB%E3%82%A2%E3%82%A4%E3%83%87%E3%83%B3%E3%83%86%E3%82%A3%E3%83%95%E3%82%A1%E3%82%A4%E3%83%89%E3%83%BB%E3%83%A1%E3%83%BC%E3%83%AB)を用いてメールの信頼性を検証するメールクライアントも増えてきています。  
SendGridでもこれらの設定を行うことで信頼性を向上させることが可能ですので下記ドキュメントを参照して設定を行ってください。

- [独自ドメインを利用するには](https://sendgrid.kke.co.jp/blog/?p=1107)
- [Whitelabel Wizard](https://sendgrid.com/docs/User_Guide/whitelabel_wizard.html)

※ DKIMの設定にはSilver以上のプランを使用する必要があります。

### 関連ソース(ソースの閲覧には権限が必要です。)

- [MailServlet.java](https://github.com/FLECT-DEV-TEAM/heroku-samples/blob/master/src/main/java/herokuSamples/web/mail/MailServlet.java)
</div>
